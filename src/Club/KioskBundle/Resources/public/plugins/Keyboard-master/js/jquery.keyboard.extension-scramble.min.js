/* jQuery UI Virtual Keyboard Scramble Extension v1.2 for Keyboard v1.18+ (updated 6/1/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(b){b.keyboard=b.keyboard||{};b.fn.addScramble=function(s){var t={targetKeys:/[a-z\d]/i,byRow:!0,randomizeOnce:!0};return this.each(function(){var k,a=b(this).data("keyboard"),d=a.options;a&&(k=a.scramble_options=b.extend({},t,s),a.scramble_setup=function(g){var r,q,f,c,d,l,h,n,p,m,e;r=g.find(".ui-keyboard-keyset");if(g.length){for(q=0;q<r.length;q++)if(f=r.eq(q),h=0,e=[],p=[],n=[],m=[],f.children("button, span, br").each(function(){"BR"===this.tagName?(k.byRow?(e.push(this),p.push(!1),m[h]= e,n[h]=p,e=[],p=[]):(m[h]=this,n[h]=!1),h++):(l=b(this).attr("data-value")||"",l=1===l.length&&k.targetKeys.test(l)?l:!1,k.byRow?(e.push(this),p.push(l)):(m[h]=this,n[h]=l,h++))}),f.find(".ui-keyboard-button-endrow").remove(),k.byRow)for(d=0;d<m.length;d++)for(e=a.shuffle(m[d],n[d]),c=0;c<e.length;c++)f.append(e[c]);else for(e=a.shuffle(m,n),c=0;c<e.length;c++)f.append(e[c]);return g}},a.shuffle=function(a,b){for(var d,f,c=a.length;0<c;)f=Math.floor(Math.random()*c),!1===b[c-1]&&c--,!1!==b[c-1]&& !1!==b[f]&&(c--,d=a[c],a[c]=a[f],a[f]=d);return a},d.create=function(){console.log("create run");var g=d.layout;b.keyboard.builtLayouts[g]={mappedKeys:{},acceptedKeys:[],$keyboard:null};"undefined"===typeof b.keyboard.builtLayouts[a.orig_layout]&&(a.layout=d.layout=a.orig_layout,a.buildKeyboard(),a.layout=d.layout=g);b.keyboard.builtLayouts[g]=b.extend(!0,{},b.keyboard.builtLayouts[a.orig_layout]);k.randomizeOnce&&(b.keyboard.builtLayouts[g].$keyboard=a.scramble_setup(b.keyboard.builtLayouts[a.orig_layout].$keyboard.clone())); a.$keyboard=b.keyboard.builtLayouts[g].$keyboard;k.randomizeOnce||a.$el.bind("beforeVisible.keyboard",function(a,b){b.$keyboard=b.scramble_setup(b.$keyboard)})},a.orig_layout=d.layout,d.layout="scrambled"+Math.round(1E4*Math.random()),d.alwaysOpen&&a.$keyboard.length&&setTimeout(function(){a.$keyboard=a.scramble_setup(a.$keyboard)},0))})}})(jQuery);
